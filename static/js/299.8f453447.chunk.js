"use strict";(self.webpackChunkreact_monkey_blogging_boilerplate=self.webpackChunkreact_monkey_blogging_boilerplate||[]).push([[299],{2299:function(e,t,n){n.r(t),n.d(t,{default:function(){return A}});var r=n(1413),a=n(5861),s=n(9439),i=n(7757),o=n.n(i),c=n(4167),u=n(5456),l=n(9501),d=n(9248),p=n(3031),h=n(3117),f=n(6848),m=n(4961),g=n(1199),x=n(9062),v=n(1776),b=n(8322),j=n(2791),k=n(1134),y=n(3504),w=n(3585),Z=n(6770),N=n.n(Z),E=(n(6009),n(577)),I=n(8113),_=n(4569),C=n.n(_),D=n(333),S=n.n(D),U=n(9808),P=n(1830),J=n.n(P),L=n(184);Z.Quill.register("modules/imageUploader",I.Z);var A=function(){var e=(0,U.a)().userInfo,t=(0,y.lr)(),n=(0,s.Z)(t,1)[0].get("id"),i=(0,j.useState)(""),Z=(0,s.Z)(i,2),I=Z[0],_=Z[1],D=(0,k.cI)({mode:"onChange"}),P=D.handleSubmit,A=D.control,F=D.setValue,T=D.watch,Y=D.reset,R=D.getValues,V=D.formState,O=V.isValid,M=V.isSubmitting,Q=R("image"),q=R("image_name"),G=(0,v.Z)(F,R,q,(function(){return X.apply(this,arguments)})),z=G.image,B=G.setImage,H=G.progress,K=G.handleSelectImage,W=G.handleDeleteImage;function X(){return(X=(0,a.Z)(o().mark((function t(){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((null===e||void 0===e?void 0:e.role)===w.xZ.ADMIN){t.next=3;break}return J().fire("Failed","You have no right to do this action","warning"),t.abrupt("return");case 3:return r=(0,x.JU)(g.db,"users",n),t.next=6,(0,x.r7)(r,{avatar:""});case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}(0,j.useEffect)((function(){B(Q)}),[Q,B]);var $=T("hot"),ee=T("status");(0,j.useEffect)((function(){function e(){return(e=(0,a.Z)(o().mark((function e(){var t,r,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return t=(0,x.JU)(g.db,"posts",n),e.next=5,(0,x.QT)(t);case 5:(r=e.sent).data()&&(Y(r.data()),ae((null===(a=r.data())||void 0===a?void 0:a.category)||""),_((null===(s=r.data())||void 0===s?void 0:s.content)||""));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n,Y]);var te=(0,j.useState)(""),ne=(0,s.Z)(te,2),re=ne[0],ae=ne[1],se=(0,j.useState)([]),ie=(0,s.Z)(se,2),oe=ie[0],ce=ie[1];(0,j.useEffect)((function(){function e(){return(e=(0,a.Z)(o().mark((function e(){var t,n,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,x.hJ)(g.db,"categories"),n=(0,x.IO)(t,(0,x.ar)("status","==",1)),e.next=4,(0,x.PL)(n);case 4:a=e.sent,s=[],a.forEach((function(e){s.push((0,r.Z)({id:e.id},e.data()))})),ce(s);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var ue=function(){var e=(0,a.Z)(o().mark((function e(t){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,x.JU)(g.db,"categories",t.id),e.next=3,(0,x.QT)(n);case 3:a=e.sent,F("category",(0,r.Z)({id:a.id},a.data())),ae(t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),le=function(){var t=(0,a.Z)(o().mark((function t(a){var s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(O){t.next=2;break}return t.abrupt("return");case 2:if((null===e||void 0===e?void 0:e.role)===w.xZ.ADMIN){t.next=5;break}return J().fire("Failed","You have no right to do this action","warning"),t.abrupt("return");case 5:return s=(0,x.JU)(g.db,"posts",n),a.status=Number(a.status),a.slug=S()(a.slug||a.title,{lower:!0}),t.next=10,(0,x.r7)(s,(0,r.Z)((0,r.Z)({},a),{},{image:z,content:I}));case 10:E.Am.success("Update post successfully!");case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),de=(0,j.useMemo)((function(){return{toolbar:[["bold","italic","underline","strike"],["blockquote"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],["link","image"]],imageUploader:{upload:function(){var e=(0,a.Z)(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("upload: ~ file",t),n=new FormData,console.log("upload: ~ bodyFormData",n),n.append("image",t),e.next=6,C()({method:"post",url:"https://api.imgbb.com/1/upload?key=25e8d127b24f64722df7b606670d08d2",data:n,headers:{"Content-Type":"multipart/form-data"}});case 6:return r=e.sent,e.abrupt("return",r.data.data.url);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}}),[]);return n?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(b.Z,{title:"Update post",desc:"Update post content"}),(0,L.jsxs)("form",{onSubmit:P(le),children:[(0,L.jsxs)("div",{className:"form-layout",children:[(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Title"}),(0,L.jsx)(h.I,{control:A,placeholder:"Enter your title",name:"title",required:!0})]}),(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Slug"}),(0,L.jsx)(h.I,{control:A,placeholder:"Enter your slug",name:"slug"})]})]}),(0,L.jsxs)("div",{className:"form-layout",children:[(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Image"}),(0,L.jsx)(p.Z,{onChange:K,handleDeleteImage:W,className:"h-[250px]",progress:H,image:z})]}),(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Category"}),(0,L.jsxs)(l.L,{children:[(0,L.jsx)(l.L.Select,{placeholder:"Select the category"}),(0,L.jsx)(l.L.List,{children:oe.length>0&&oe.map((function(e){return(0,L.jsx)(l.L.Option,{onClick:function(){return ue(e)},children:e.name},e.id)}))})]}),(null===re||void 0===re?void 0:re.name)&&(0,L.jsx)("span",{className:"inline-block p-3 text-sm font-medium text-green-600 rounded-lg bg-green-50",children:null===re||void 0===re?void 0:re.name})]})]}),(0,L.jsx)("div",{className:"mb-10",children:(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Content"}),(0,L.jsx)("div",{className:"w-full entry-content",children:(0,L.jsx)(N(),{modules:de,theme:"snow",value:I,onChange:_})})]})}),(0,L.jsxs)("div",{className:"form-layout",children:[(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Feature post"}),(0,L.jsx)(m.Z,{on:!0===$,onClick:function(){return F("hot",!$)}})]}),(0,L.jsxs)(d.g,{children:[(0,L.jsx)(f._,{children:"Status"}),(0,L.jsxs)(d.Y,{children:[(0,L.jsx)(u.Y,{name:"status",control:A,checked:Number(ee)===w.cf.APPROVED,value:w.cf.APPROVED,children:"Approved"}),(0,L.jsx)(u.Y,{name:"status",control:A,checked:Number(ee)===w.cf.PENDING,value:w.cf.PENDING,children:"Pending"}),(0,L.jsx)(u.Y,{name:"status",control:A,checked:Number(ee)===w.cf.REJECTED,value:w.cf.REJECTED,children:"Reject"})]})]})]}),(0,L.jsx)(c.z,{type:"submit",className:"mx-auto w-[250px]",isLoading:M,disabled:M,children:"Update post"})]})]}):null}}}]);
//# sourceMappingURL=299.8f453447.chunk.js.map